import os
import math


def calc_num_padding_zeros(collection):
    return math.floor(math.log10(len(collection))) + 1


def split_keep_prefix(base_string, split_string, clear_empty=True):
    return [split_string + split
            for split in base_string.split(split_string)
            if split != '' or not clear_empty
            ]


def save_text_list(text_list, prefix, save_dir, limit=None):
    """
    Saves list of text strings into files. The filenames are generated by enumerating the list of strings
        and prepending 'prefix'. The number of files saved can be limited by 'limit'.
    :param text_list: list of strings
    :param prefix: a string to be prepended to file names
    :param save_dir: directory to save file
    :param limit: save at most this many files
    :return: list of filenames of all files created
    """

    if limit is not None:
        text_list = text_list[:limit]

    padding_zeros = calc_num_padding_zeros(text_list)

    filenames = []

    for i, pgn_str in enumerate(text_list):
        filename = prefix + str(i).zfill(padding_zeros)
        filenames.append(filename)
        path = os.path.join(save_dir, filename)
        with open(path, 'w', encoding='utf-8') as f:
            try:
                f.write(pgn_str)
            except Exception as inst:
                print(inst)
                print(pgn_str)

    return filenames

if __name__ == "__main__":
    user_pgn_path = 'C:\\Users\\tamiq\\Downloads\\ChessCom_erik_200910.pgn'
    save_dir = 'C:\\Users\\tamiq\\PycharmProjects\\ChessStyles\\game_data'
    with open(user_pgn_path, 'r') as f:
        text_data = f.read()

    save_text_list(text_data, '[Event', 'erik' + '_', save_dir, limit=5)
